<include file="Public/min-header"/>
<script type="text/javascript">
    window.UEDITOR_Admin_URL = "__ROOT__/Public/plugins/Ueditor/";
    var URL_upload = "{$URL_upload}";
    var URL_fileUp = "{$URL_fileUp}";
    var URL_scrawlUp = "{$URL_scrawlUp}";
    var URL_getRemoteImage = "{$URL_getRemoteImage}";
    var URL_imageManager = "{$URL_imageManager}";
    var URL_imageUp = "{$URL_imageUp}";
    var URL_getMovie = "{$URL_getMovie}";
    var URL_home = "{$URL_home}";    
</script>

<load href="__ROOT__/Public/plugins/Ueditor/ueditor.config.js"/>
<load href="__ROOT__/Public/plugins/Ueditor/ueditor.all.js"/>
<link href="__PUBLIC__/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
<script src="__PUBLIC__/plugins/daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script>

<div class="wrapper">
    <include file="Public/breadcrumb"/>
   	<section class="content">
       <div class="row">
			<div class="col-md-12">
			
			<div class="box box-info">
                <div class="box-header with-border">
                  <h3 class="box-title">发送邮件</h3>
                  <a href="{:U('Article/articleList')}" data-toggle="tooltip" title="" class="btn btn-default pull-right" data-original-title="返回"><i class="fa fa-reply"></i></a>
                </div>
                <form class="form-horizontal" action="{:U('Article/aticleHandle')}" id="add_post" method="post">
                  <div class="box-body">
                    <div class="form-group">
                      <label for="inputEmail3" class="col-sm-2 control-label">邮箱账号：</label>
                      <div class="col-sm-8">
                        <input type="text" class="" name="user" >@henvik.com
                        <p class="text-info">只支持：@henvik.com  结尾的邮箱</p>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="inputEmail3" class="col-sm-2 control-label">邮箱密码:</label>
                      <div class="col-sm-2">
                        <input type="password" class="form-control" name="password" >
                      </div>
                    </div>
                    <div class="form-group">
                    	<label for="text" class="col-sm-2 control-label">收件人账号：</label>                   	
                    	<div class="col-sm-4">
                        <textarea class="form-control" rows="3" name="target"></textarea>
                        <p class="text-info">一行为一个收件人账号</p>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="inputEmail3" class="col-sm-2 control-label">邮件标题:</label>
                      <div class="col-sm-8">
                        <input type="text" class="form-control" name="title" >
                      </div>
                    </div> 
                    <div class="form-group">
	                    <label class="control-label col-sm-2">邮件内容:</label>
	                    <div class="col-sm-8">
                        <p class="text-info">提示：可从文章分类为‘邮件模板’里复制相关内容到下面的文本框 (暫不支持附件功能)</p>
        				        <!-- <textarea class="span12 ckeditor" id="post_content" name="content">                
                        </textarea> -->
                        <textarea class="form-control" rows="3" name="content"></textarea>
	                    </div>
                    </div>
                    <div class="form-group">
                    	<label class="control-label col-sm-2">              
                    		<input type="hidden" name="act" value="{$act}">
	                  	 	<input type="hidden" name="article_id" value="{$info.article_id}"></label>
                    	 <div class="col-sm-8">
                    	 	<button type="reset" class="btn btn-default" disabled="disabled">重置</button>
                    	  <button type="button"  onclick="sendEmail()" class="btn btn-info pull-right">提交</button>
                    	 </div>
                    </div>
                  </div>
                   
                </form>
              </div>

          </div>
	   </div>
	</section>
</div>

<script type="text/javascript">
  var editor;
  $(function () {
        //具体参数配置在  editor_config.js 中
        var options = {
            zIndex: 999,
            initialFrameWidth: "100%", //初化宽度
            initialFrameHeight: 400, //初化高度
            focus: false, //初始化时，是否让编辑器获得焦点true或false
            maximumWords: 99999, removeFormatAttributes: 'class,style,lang,width,height,align,hspace,valign',//允许的最大字符数 'fullscreen',
            pasteplain:false, //是否默认为纯文本粘贴。false为不使用纯文本粘贴，true为使用纯文本粘贴
            autoHeightEnabled: true
         /*   autotypeset: {
                mergeEmptyline: true,        //合并空行
                removeClass: true,           //去掉冗余的class
                removeEmptyline: false,      //去掉空行
                textAlign: "left",           //段落的排版方式，可以是 left,right,center,justify 去掉这个属性表示不执行排版
                imageBlockLine: 'center',    //图片的浮动方式，独占一行剧中,左右浮动，默认: center,left,right,none 去掉这个属性表示不执行排版
                pasteFilter: false,          //根据规则过滤没事粘贴进来的内容
                clearFontSize: false,        //去掉所有的内嵌字号，使用编辑器默认的字号
                clearFontFamily: false,      //去掉所有的内嵌字体，使用编辑器默认的字体
                removeEmptyNode: false,      //去掉空节点
                                             //可以去掉的标签
                removeTagNames: {"font": 1},
                indent: false,               // 行首缩进
                indentValue: '0em'           //行首缩进的大小
            }*/
        };
        editor = new UE.ui.Editor(options);
        editor.render("post_content");
  });  
    
	
	function sendEmail(){
		if($.trim($('input[name="user"]').val()) == ''){
			alert("请填写邮箱账号！");
			return false;
		};
    if($.trim($('input[name="password"]').val()) == ''){
      alert("请填写邮箱密码！");
      return false;
    }
    if($.trim($('textarea[name="target"]').val()) == ''){
      alert("请填写收件人邮箱！");
      return false;
    }
    if($.trim($('input[name="title"]').val()) == ''){
      alert("邮件标题不能为空！");
      return false;
    }
		if($('#post_content').val() == ''){
			alert("请填写邮件内容！");
			return false;
		}

		$.ajax({
      url: "{:U('Article/send_email')}",
      type: 'POST',
      data: $('#add_post').serialize(),
      success : function(res){
        if(res!=0){
          layer.msg('发送成功', {icon: 1});
        }else{
          layer.msg('发送失败', {icon: 2,time: 2000});
        }
      }
    });
    
	}
</script>
</body>
</html>